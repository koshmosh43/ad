/** <<FontResolver> function dependency: >.init **/

troikaDefine(
function(){return (
function(){return function(t){var e=function(){this.buckets=new Map};e.prototype.add=function(t){var e=t>>5;this.buckets.set(e,(this.buckets.get(e)||0)|1<<(31&t))},e.prototype.has=function(t){var e=this.buckets.get(t>>5);return void 0!==e&&0!=(e&1<<(31&t))},e.prototype.serialize=function(){var t=[];return this.buckets.forEach((function(e,i){t.push((+i).toString(36)+":"+e.toString(36))})),t.join(",")},e.prototype.deserialize=function(t){var e=this;this.buckets.clear(),t.split(",").forEach((function(t){var i=t.split(":");e.buckets.set(parseInt(i[0],36),parseInt(i[1],36))}))};var i=Math.pow(2,8),n=i-1,r=~n;function o(t){var e=function(t){return t&r}(t).toString(16),n=function(t){return(t&r)+i-1}(t).toString(16);return"codepoint-index/plane"+(t>>16)+"/"+e+"-"+n+".json"}function a(t,e){var i=t&n,r=e.codePointAt(i/6|0);return 0!=((r=(r||48)-48)&1<<i%6)}function s(t,e){!function(t,e){var i;(i=t,i.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map((function(t){return t.split("-").map((function(t){return parseInt(t.trim(),16)}))}))).forEach((function(t){var i=t[0],n=t[1];void 0===n&&(n=i),e(i,n)}))}(t,(function(t,i){for(var n=t;n<=i;n++)e(n)}))}var l={},h={},c=new WeakMap,u="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function d(t){var i=c.get(t);return i||(i=new e,s(t.ranges,(function(t){return i.add(t)})),c.set(t,i)),i}var p,m=new Map;function g(t,e,i){return t[e]?e:t[i]?i:function(t){for(var e in t)return e}(t)}function f(t,e){var i=e;if(!t.includes(i)){i=1/0;for(var n=0;n<t.length;n++)Math.abs(t[n]-e)<Math.abs(i-e)&&(i=t[n])}return i}function M(t){return p||(p=new Set,s("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",(function(t){p.add(t)}))),p.has(t)}return t.CodePointSet=e,t.clearCache=function(){l={},h={}},t.getFontsForString=function(t,e){void 0===e&&(e={});var i,n=e.lang;void 0===n&&(n=/\p{Script=Hangul}/u.test(i=t)?"ko":/\p{Script=Hiragana}|\p{Script=Katakana}/u.test(i)?"ja":"en");var r=e.category;void 0===r&&(r="sans-serif");var s=e.style;void 0===s&&(s="normal");var c=e.weight;void 0===c&&(c=400);var p=(e.dataUrl||u).replace(/\/$/g,""),y=new Map,v=new Uint8Array(t.length),b={},A={},P=new Array(t.length),x=new Map,S=!1;function C(t){var e=m.get(t);return e||(e=fetch(p+"/"+t).then((function(t){if(!t.ok)throw new Error(t.statusText);return t.json().then((function(t){if(!Array.isArray(t)||1!==t[0])throw new Error("Incorrect schema version; need 1, got "+t[0]);return t[1]}))})).catch((function(e){if(p!==u)return S||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+p+'", trying default CDN. '+e.message),S=!0),p=u,m.delete(t),C(t);throw e})),m.set(t,e)),e}for(var _=function(e){var i=t.codePointAt(e),n=o(i);P[e]=n,l[n]||x.has(n)||x.set(n,C(n).then((function(t){l[n]=t}))),i>65535&&(e++,w=e)},w=0;w<t.length;w++)_(w);return Promise.all(x.values()).then((function(){x.clear();for(var e=function(e){var r=t.codePointAt(e),o=null,s=l[P[e]],c=void 0;for(var u in s){var d=A[u];if(void 0===d&&(d=A[u]=new RegExp(u).test(n||"en")),d){for(var p in c=u,s[u])if(a(r,s[u][p])){o=p;break}break}}if(!o)t:for(var m in s)if(m!==c)for(var g in s[m])if(a(r,s[m][g])){o=g;break t}o||(console.debug("No font coverage for U+"+r.toString(16)),o="latin"),P[e]=o,h[o]||x.has(o)||x.set(o,C("font-meta/"+o+".json").then((function(t){h[o]=t}))),r>65535&&(e++,i=e)},i=0;i<t.length;i++)e(i);return Promise.all(x.values())})).then((function(){for(var e,i=null,n=0;n<t.length;n++){var o=t.codePointAt(n);if(i&&(M(o)||d(i).has(o)))v[n]=v[n-1];else{i=h[P[n]];var a=b[i.id];if(!a){var l=i.typeforms,u=g(l,r,"sans-serif"),m=g(l[u],s,"normal"),A=f(null===(e=l[u])||void 0===e?void 0:e[m],c);a=b[i.id]=p+"/font-files/"+i.id+"/"+u+"."+m+"."+A+".woff"}var x=y.get(a);null==x&&(x=y.size,y.set(a,x)),v[n]=x}o>65535&&(n++,v[n]=v[n-1])}return{fontUrls:Array.from(y.keys()),chars:v}}))},Object.defineProperty(t,"__esModule",{value:!0}),t}({})}
)}
)